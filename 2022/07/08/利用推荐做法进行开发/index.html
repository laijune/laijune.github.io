<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="利用推荐做法进行开发 使用推荐做法DO447 介绍了红帽 Ansible 自动化的诸多高级功能，也阐述了如何有效并高效的使用红帽 Ansible 自动化。 有效使用 Ansible 不仅仅在于功能或工具，也关乎实践方法和项目组织。 以下三点概述了红帽 Anisible 自动化的有效使用（基于 Jeff Geering 类似言论）：  保持简单	Keep Things Simple 井然有序">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2022/07/08/%E5%88%A9%E7%94%A8%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="利用推荐做法进行开发 使用推荐做法DO447 介绍了红帽 Ansible 自动化的诸多高级功能，也阐述了如何有效并高效的使用红帽 Ansible 自动化。 有效使用 Ansible 不仅仅在于功能或工具，也关乎实践方法和项目组织。 以下三点概述了红帽 Anisible 自动化的有效使用（基于 Jeff Geering 类似言论）：  保持简单	Keep Things Simple 井然有序">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/Typora%20%E5%9B%BE%E5%83%8F/image-20220707155741784.png">
<meta property="og:image" content="http://example.com/Typora%20%E5%9B%BE%E5%83%8F/image-20220707160702025.png">
<meta property="article:published_time" content="2022-07-08T02:25:49.592Z">
<meta property="article:modified_time" content="2022-07-07T08:09:11.989Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/Typora%20%E5%9B%BE%E5%83%8F/image-20220707155741784.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-利用推荐做法进行开发" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/08/%E5%88%A9%E7%94%A8%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91/" class="article-date">
  <time class="dt-published" datetime="2022-07-08T02:25:49.592Z" itemprop="datePublished">2022-07-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="利用推荐做法进行开发"><a href="#利用推荐做法进行开发" class="headerlink" title="利用推荐做法进行开发"></a>利用推荐做法进行开发</h3><hr>
<h4 id="使用推荐做法"><a href="#使用推荐做法" class="headerlink" title="使用推荐做法"></a>使用推荐做法</h4><p>DO447 介绍了红帽 Ansible 自动化的诸多高级功能，也阐述了如何有效并高效的使用红帽 Ansible 自动化。</p>
<p>有效使用 Ansible <a href="">不仅仅在于功能或工具，也关乎实践方法和项目组织</a>。</p>
<p>以下三点概述了红帽 Anisible 自动化的有效使用（基于 Jeff Geering 类似言论）：</p>
<ul>
<li>保持简单	Keep Things Simple</li>
<li>井然有序    Stay Organized</li>
<li>经常测试    Test Often</li>
</ul>
<p><strong>保持 Playbook 的可读性</strong></p>
<p>合理地使用垂直空白和注释。</p>
<p>始终为 play 和任务提供有意义的名称，明确 play 或任务的用途。</p>
<p>YAML 不属于编程语言。它非常适合表述一系列任务或项目，或者一组键值对。如果难以在Ansible Playbook 中表述一些复杂的控制结构或条件，可以通过模板和 Jinjia2 过滤器巧妙地处理变量中的数据。</p>
<p><strong>使用现有的模块</strong></p>
<p>编写新 playbook 时，请从基础 playbook 开始，并尽可能使用静态清单。</p>
<p>在构建设计时，将debug 模块用作测试或存根。</p>
<p>在 playbook 按预期工作后，使用 import 或 include 将 playbook 分成较小的逻辑组件。</p>
<p>使用 Ansible 中包含的特殊用途模块，而不是 command、shell、raw 或其他类似的模块。使用为特定任务设计的模块可以轻松地使 Playbook 具有幂等性，且易于维护。</p>
<p><code>command、shell、raw模块更多的是结合ad-hoc临时命令做测试,非入侵性的操作</code></p>
<p><strong>遵循标准样式</strong></p>
<p>编写 Ansible 项目时，应考虑和同事遵循标准的 “样式”：</p>
<ul>
<li>缩进多少个空格</li>
<li>如何使用垂直空白</li>
<li>如何命名 task play role 和 var</li>
<li>应对什么进行注释</li>
<li>如何注释</li>
</ul>
<p>遵循统一的标准有助于提高维护性和可读性。</p>
<p><strong>遵循变量命名约定</strong></p>
<p>因为 Ansible 具有相对扁平的命名空间，所以变量名非常重要。应使用描述性变量且应阐明内容，如 apache_tls_port，在角色中最好能给角色变量添加前缀，如 myapp_apache_tls_port。</p>
<p><strong>测试任务的结果</strong></p>
<p>如果需要确认任务是否成功，请验证任务的结果，<font color=blue>而不要信任模块的返回代码</font>。</p>
<h5 id="指导练习"><a href="#指导练习" class="headerlink" title="指导练习"></a>指导练习</h5><p><code>在本次练习中,你将对已存在的Ansible 项目应用最佳实践方法</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;student&#x27;</span>用户登录workstation,执行一个lab脚本</span><br><span class="line">[student@workstation ~]$ lab development-practices start</span><br><span class="line"></span><br><span class="line">初始化Ansible 项目在~/DO447/labs/development-practices</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">进入项目目录</span><br><span class="line">[student@workstation ~]$ <span class="built_in">cd</span> DO447/labs/development-practices/</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&gt; 为了避免变量冲突,在<span class="string">&#x27;haproxy&#x27;</span>role里的变量都加一个haproxy_做区分</span><br><span class="line">[student@workstation development-practices]$ vim roles/haproxy/defaults/main.yml			`无var目录,则变量放在defaults目录下`</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log-level for HAProxy logs</span></span><br><span class="line">log_level: info						👉			haproxy_log_level: info</span><br><span class="line"></span><br><span class="line"><span class="comment"># Port exposed to clients</span></span><br><span class="line">port: 80							👉			haproxy_port: 80</span><br><span class="line"></span><br><span class="line"><span class="comment"># Name for the default backend	</span></span><br><span class="line">backend_name: app					👉			haproxy_backend_name: app</span><br><span class="line"></span><br><span class="line"><span class="comment"># Port backend is exposed to</span></span><br><span class="line">backend_port: 80					👉			haproxy_backend_port: 80</span><br><span class="line"></span><br><span class="line"><span class="comment"># The appservers variable is a list</span></span><br><span class="line"><span class="comment"># of backend servers that provide</span></span><br><span class="line"><span class="comment"># the web service that is proxied</span></span><br><span class="line"><span class="comment"># haproxy.  Each server must define:</span></span><br><span class="line"><span class="comment"># name, address, port. Below is</span></span><br><span class="line"><span class="comment"># and example structure:</span></span><br><span class="line"><span class="comment"># appservers:</span></span><br><span class="line"><span class="comment">#   - name: serverb.lab.example.com</span></span><br><span class="line"><span class="comment">#     ip_address: 1.2.3.4</span></span><br><span class="line"><span class="comment">#     port: 5000</span></span><br><span class="line"><span class="comment">#   - name: serverc.lab.example.com</span></span><br><span class="line"><span class="comment">#     ip_address: 1.2.3.5</span></span><br><span class="line"><span class="comment">#     port: 5000</span></span><br><span class="line"><span class="comment"># The default is no defined backend servers.</span></span><br><span class="line">appservers: []						👉			haproxy_appservers: []</span><br><span class="line"></span><br><span class="line"><span class="comment"># Socket used to communicate with haproxy service. DO NOT CHANGE</span></span><br><span class="line">socket: /var/run/haproxy.sock		👉			haproxy_socket: /var/run/haproxy.sock</span><br><span class="line"></span><br><span class="line">&gt; 更新定义变量的文件————roles/haproxy/templates/haproxy.cfg.j2</span><br><span class="line">...output omitted...</span><br><span class="line">global</span><br><span class="line">    <span class="comment">#Send events/messages to rsyslog server.</span></span><br><span class="line">    <span class="built_in">log</span>         127.0.0.1:514 local0 &#123;&#123; log_level &#125;&#125;					👉			 &#123;&#123; haproxy_log_level &#125;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">chroot</span>      /var/lib/haproxy</span><br><span class="line">    pidfile     /var/run/haproxy.pid</span><br><span class="line">    maxconn     4000</span><br><span class="line">    user        haproxy</span><br><span class="line">    group       haproxy</span><br><span class="line">    daemon</span><br><span class="line"></span><br><span class="line">   <span class="comment">#state changes due to API calls are stored in this file.</span></span><br><span class="line">   server-state-file /usr/local/haproxy/haproxy.state</span><br><span class="line"></span><br><span class="line">    <span class="comment"># turn on stats unix socket</span></span><br><span class="line">    <span class="comment">#  required for the ansible haproxy module.</span></span><br><span class="line">    stats socket &#123;&#123; socket &#125;&#125; level admin								👉			&#123;&#123; haproxy_socket &#125;&#125;</span><br><span class="line">...output omitted...</span><br><span class="line"></span><br><span class="line">frontend main</span><br><span class="line">    mode http</span><br><span class="line">    <span class="built_in">bind</span> *:&#123;&#123; port &#125;&#125;													👉			&#123;&#123; haproxy_port &#125;&#125;</span><br><span class="line">    default_backend &#123;&#123; backend_name &#125;&#125;									👉			&#123;&#123; haproxy_backend_name &#125;&#125;</span><br><span class="line">...output omitted...</span><br><span class="line"></span><br><span class="line">backend &#123;&#123; backend_name &#125;&#125;												👉			&#123;&#123; haproxy_backend_name &#125;&#125;</span><br><span class="line">    balance roundrobin</span><br><span class="line">&#123;% <span class="keyword">for</span> server <span class="keyword">in</span> appservers %&#125;											👉			&#123;% <span class="keyword">for</span> server <span class="keyword">in</span> haproxy_appservers %&#125;</span><br><span class="line">    server &#123;&#123; server.name &#125;&#125; &#123;&#123; server.ip &#125;&#125;:&#123;&#123; backend_port &#125;&#125;			👉			&#123;&#123; haproxy_backend_port &#125;&#125;					</span><br><span class="line">&#123;% endfor %&#125;					</span><br><span class="line"></span><br><span class="line">&gt; 创建一个group_vars目录</span><br><span class="line">[student@workstation development-practices]$ <span class="built_in">mkdir</span> group_vars</span><br><span class="line"></span><br><span class="line">&gt; 将<span class="string">&#x27;appservers.yml&#x27;</span>文件拷贝到group_vars目录下,名称改成<span class="string">&#x27;lb_servers.yml&#x27;</span></span><br><span class="line">[student@workstation development-practices]$ <span class="built_in">cp</span> appservers.yml group_vars/lb_servers.yml</span><br><span class="line"></span><br><span class="line">因为清单里定义了[lb_servers]组,意味着<span class="string">&#x27;lb_servers.yml&#x27;</span>文件是只针对servera用的变量</span><br><span class="line">[student@workstation development-practices]$ <span class="built_in">cat</span> inventory</span><br><span class="line">[lb_servers]</span><br><span class="line">servera.lab.example.com</span><br><span class="line"></span><br><span class="line">[web_servers]</span><br><span class="line">server[b:c].lab.example.com</span><br><span class="line"></span><br><span class="line">&gt; 查看<span class="string">&#x27;lb_servers.yml&#x27;</span>变量内容,并更改成指定到变量名称</span><br><span class="line">[student@workstation development-practices]$ vim group_vars/lb_servers.yml</span><br><span class="line">`定义了一个列表`</span><br><span class="line">appservers:			👉		  haproxy_appservers</span><br><span class="line">  - name: serverb.lab.example.com</span><br><span class="line">    ip: <span class="string">&quot;172.25.250.11&quot;</span></span><br><span class="line">  - name: serverc.lab.example.com</span><br><span class="line">    ip: <span class="string">&quot;172.25.250.12&quot;</span></span><br><span class="line">    </span><br><span class="line">&gt; 定义web应用的主机在欧洲(Europe)提供不同的信息</span><br><span class="line">&gt; 在清单定义<span class="string">&quot;欧洲&quot;</span>组[region_eu]</span><br><span class="line">...</span><br><span class="line">[region_eu]</span><br><span class="line">serverc.lab.example.com</span><br><span class="line"></span><br><span class="line">&gt; 单独的给这个组赋予一个变量</span><br><span class="line">[student@workstation development-practices]$ vim group_vars/region_eu.yml</span><br><span class="line">webapp_message: <span class="string">&quot;Hello from Europe. This is&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; 执行playbook: `servera是负载均衡,serverb和serverc是web服务器同时部署了一个网页,其中serverc的网页来自欧洲【覆盖了一个变量】`</span><br><span class="line">[student@workstation development-practices]$ ansible-playbook site.yml</span><br><span class="line"></span><br><span class="line">&gt; 测试</span><br><span class="line">&gt; 访问负载均衡的节点servera</span><br><span class="line">[student@workstation development-practices]$ curl servera</span><br><span class="line">This is serverb. (version v1.0)</span><br><span class="line">[student@workstation development-practices]$ curl servera</span><br><span class="line">Hello from Europe. This is serverc. (version v1.0)</span><br><span class="line">`因为是roundrobin(轮询的),所以下一个请求会给到serverc,serverc会返回我们覆盖的变量`</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">结束实验</span><br><span class="line">[student@workstation development-practices]$ ansible-playbook clean.yml</span><br><span class="line">[student@workstation ~]$ lab development-practices finish</span><br></pre></td></tr></table></figure>



<h4 id="使用-Git-管理-Ansible-项目资料"><a href="#使用-Git-管理-Ansible-项目资料" class="headerlink" title="使用 Git 管理 Ansible 项目资料"></a>使用 Git 管理 Ansible 项目资料</h4><p><strong>基础架构即代码</strong></p>
<p>一个关键的 DevOps 概念是基础架构即代码理念。不必手动管理基础架构，而是通过运行自动化代码来定义和构建系统。红帽 Ansible 自动化是一种可帮助实施这种方法的关键工具。</p>
<p>如果 Ansible 项目是用于定义基础架构的代码，则应使用 Git 等版本控制系统来跟踪和控制代码的更改。版本控制能够为基础架构代码的不同阶段（如开发、测试和生产）实施生命周期。可以将更改提交到分支，并在非关键性开发和 QA 环境中测试这些更改。在对更改有了信息后，可以将它们合并到主生产代码，并将更改应用到生产基础架构。</p>
<p><strong>Git 简介</strong></p>
<p>Git 是一种分布式修订控制系统（DVCS），能够让开发人员以协作方式管理项目中的文件更改。</p>
<p>文件的每一次修改都提交到系统。</p>
<p>可以恢复旧版本的文件，并且维护进行更改的人员的日志。</p>
<p>GIt 是一种分布式版本控制系统。每个开发人员一开始都可以从远程存储库中克隆现有的共享项目。</p>
<p>开发人员在本地工作树中进行编辑，然后，暂存一组相关的更改并提交到本地存储库。</p>
<p>当开发人员准备好共享其工作时，他们会更改推送到远程存储库。</p>
<p>当开发人员准备好使用远程存储库的最新更改更新其本地存储库时，他们可以拉取更改（从远程存储库中获取他们），并将它们合并到本地存储库中。</p>
<p><strong>Git 初始配置</strong></p>
<p>由于 Git 用户经常与多个贡献者一起修改项目，Git 会在每一次提交时记录用户的名称和电子邮件地址。这些值可以在<strong>项目级别</strong>上定义，但也可为<strong>用户设置全局默认值</strong>。</p>
<p><code>git config</code> 命令控制这些设置。将此命令与 <code>--global</code> 选项搭配时，可管理用户参与的所有 Git 项目的默认设置，会将设置保存到 ~&#x2F;.gitconfig 文件中。</p>
<p><strong><code>git config --global user.name &#39;Peter Shadowman&#39;</code></strong></p>
<p><strong><code>git config --global user.email peter@host.example.com</code></strong></p>
<p>Bash 提示符将指示以下内容：</p>
<ul>
<li>（branch *）表示跟踪的文件已经修改</li>
<li>（branch +）表示跟踪的文件已经修改并通过 <code>git add</code> 暂存</li>
<li>（branch %）表示未跟踪的文件位于树中</li>
<li><pre><code>标记可组合使用，例如（branch *+）
</code></pre>
</li>
</ul>
<p><strong>Git 工作流</strong></p>
<p>在处理共享项目时，Git 用户使用 <code>git clone</code> 命令克隆现有的上游存储库。提供的路径名或 URL 决定了哪一个存储库被克隆到当前目录中。同时也会创建工作树，使得文件和目录可随时进行修改。由于工作树是未修改的，它最初是 clean 的状态</p>
<p><code>git clone git@git.lab.example.com:project.git</code>								</p>
<blockquote>
<p><code>用户@主机名</code>			ssh 协议：意味着需要提供账号，密码或者是提供 ssh的私钥，这样才能克隆；</p>
</blockquote>
<p>另一种启动 Git 工作流的方式是使用 <code>git init</code> 命令创建一个新的私有项目。以这种方式启动项目时，不会创建远程存储库。</p>
<p><code>git init --bare</code> 在服务器上创建裸机存储库，裸机存储库没有本地工作树，因此不能使用裸机存储库来对文件进行更改。</p>
<p><code>git status</code> 命令可显示详细信息说明工作树中哪些文件已修改但未暂存、未跟踪（新的）或已暂存已供下次提交。</p>
<p><code>git add</code> 命令可暂存文件，为提交做好准备，在下一次提交时，仅会将暂存区的文件保存到存储库中。</p>
<p><code>git rm</code> 命令从工作目录中移除文件，并暂存到下一次提交时从存储库中删除该文件。</p>
<p><code>git reset</code> 命令从暂存区中删除之前为下一次提交而添加的文件。</p>
<p><code>git commit</code> 命令将已暂存的文件提交到本地 git 存储库，必须提供一条提交说明。</p>
<p>重要：</p>
<p><code>git commit</code> 命令本身不会自动提交工作树中已更改的文件。</p>
<p><code>git commit -a</code> 命令在一个步骤中暂存并提交已修改的文件。但是，改命令不会将目录中任何未跟踪（新建）的文件包含在内。添加新文件时，必须明确 <code>git add</code> 该文件在第一次进行暂存，以便为将来 <code>git commit -a</code> 命令进行跟踪。</p>
<p><code>git push</code> 命令将对本地存储库做出的更改上传到远程存储库。</p>
<p><strong>在推送之前，必须先定义默认的推送方式：</strong>	↓</p>
<p><code>git config --global push.default simple</code></p>
<p><code>git pull</code> 命令从远程存储库中获取提交，并将它们添加到本地存储库。它还将更改合并到工作树中的文件中。应当要经常运行此命令，从而获得其他人对远程存储库中项目作出的最新更改。</p>
<p><strong>创建分支</strong></p>
<p>Git 中的不同分支允许不同的工作流在同一 Git 存储库上并行演变。每个作业流的提交仅附加到该分支。使用 <code>git brahch</code> 命令，从当前的 HEAD 提交创建一个新的分支。此命令会为新分支创建一个引用，但它不会将当前 HEAD 设置为此分支。使用 <code>git checkout</code> 命令将 HEAD 移到相应的分支。</p>
<p><strong>合并分支</strong></p>
<p>分支上的工作完成后，可以将该分支与原始分支合并。</p>
<p>首先需要 <code>git checkout master</code> 命令来确保 HEAD 位于 master 分支的最新提交上，然后运行命令 <code>git merge</code> 分支名称。</p>
<p>有时，无法自动合并对多个分支的更改，因为每个分支都对相同文件的相同部分进行了更改。这种情况称为合并冲突，需要通过编辑受影响的文件来手动解决。</p>
<p><strong>从旧提交创建分支</strong></p>
<p>使用 <code>git checkout</code> 命令将 HEAD 移到任何提交。</p>
<p>例如，命令 <code>git checkout xxxxx</code> 将 HEAD 移到该提交。然后，使用 <code>git branch</code> 和 <code>git checkout</code> 命令来创建从该提交开的新分支。</p>
<p>通过使用 -b 选项运行 <code>git checkout</code> 命令，可以在一个步骤中创建一个分支并切换到该分支：</p>
<p><code>git chekcout -b feature/2</code></p>
<p><strong>将分支推送到远程存储库</strong></p>
<p>使用 <code>git push</code> 命令或 <code>--set-upstream</code> （或 -u）选项在远程存储库上创建一个将当前本地分支进行跟踪的远程分支。</p>
<p><code>git checkout feature/2</code></p>
<p><code>git push --set-upstream origin feature/2</code></p>
<h5 id="指导练习-1"><a href="#指导练习-1" class="headerlink" title="指导练习"></a>指导练习</h5><p><code>在本次练习中,你会克隆一个已包含Ansible项目的Git仓库,在本地仓库做一些更改,再提交到远程仓库中</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">执行一个lab脚本</span><br><span class="line">[student@workstation ~]$ lab development-git start 	</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">&gt; 在workstation上为student用户配置Git:</span><br><span class="line">- Git 用户名 Daniel George</span><br><span class="line">- Git 用户邮箱 daniel@lab.example.com</span><br><span class="line">- 默认推送方式 Simple</span><br><span class="line">[student@workstation ~]$ git config --global user.name <span class="string">&#x27;Daniel George&#x27;</span></span><br><span class="line">[student@workstation ~]$ git config --global user.email daniel@lab.example.com</span><br><span class="line">[student@workstation ~]$ git config --global push.default simple</span><br><span class="line"></span><br><span class="line">&gt; 检查配置				</span><br><span class="line">[student@workstation ~]$ git config --global -l</span><br><span class="line">user.name=Daniel George</span><br><span class="line">user.email=daniel@lab.example.com</span><br><span class="line">push.default=simple</span><br><span class="line">credential.helper=store</span><br><span class="line">- 配置文件在当前目录下的`.gitconfig`</span><br><span class="line"></span><br><span class="line">&gt; 查看凭据文件</span><br><span class="line">[student@workstation ~]$ <span class="built_in">cat</span> .git-credentials </span><br><span class="line">http://git:redhat321@git.lab.example.com:8081				用户名是: git	密码: redhat321	地址: git.lab.example.com:8081</span><br><span class="line"></span><br><span class="line">&gt; 创建并进入<span class="string">&#x27;git-repos&#x27;</span>目录</span><br><span class="line">[student@workstation ~]$ <span class="built_in">mkdir</span> git-repos &amp;&amp; <span class="built_in">cd</span> git-repos</span><br><span class="line"></span><br><span class="line">&gt; 克隆远程仓库地址</span><br><span class="line">[student@workstation git-repos]$ git <span class="built_in">clone</span> http://git@git.lab.example.com:8081/git/my_webservers_DEV.git</span><br><span class="line"></span><br><span class="line">&gt; 进入项目目录 &amp;&amp; 查看文件结构</span><br><span class="line">[student@workstation git-repos]$ <span class="built_in">cd</span> my_webservers_DEV/ &amp;&amp; tree</span><br><span class="line">.</span><br><span class="line">├── apache-setup.yml</span><br><span class="line">└── templates</span><br><span class="line">    ├── httpd.conf.j2</span><br><span class="line">    └── index.html.j2</span><br><span class="line"></span><br><span class="line">1 directory, 3 files</span><br><span class="line"></span><br><span class="line">&gt; 查看仓库状态</span><br><span class="line">[student@workstation my_webservers_DEV]$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up to <span class="built_in">date</span> with <span class="string">&#x27;origin/master&#x27;</span>.</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">`因为是刚<span class="built_in">clone</span>,整个工作树是clean,没有需要commit的内容`</span><br><span class="line"></span><br><span class="line">&gt; 创建一个<span class="string">&#x27;development&#x27;</span>分支,来对项目进行更改</span><br><span class="line">[student@workstation my_webservers_DEV]$ git branch development</span><br><span class="line"></span><br><span class="line">&gt; 切换到<span class="string">&#x27;development&#x27;</span>分支</span><br><span class="line">[student@workstation my_webservers_DEV]$ git checkout development</span><br><span class="line">Switched to branch <span class="string">&#x27;development&#x27;</span></span><br><span class="line"></span><br><span class="line">[student@workstation my_webservers_DEV]$ git branch</span><br><span class="line">* development</span><br><span class="line">  master</span><br><span class="line">  </span><br><span class="line">&gt; 在此分支里修改<span class="string">&#x27;templates/index.html.j2&#x27;</span>模板文件,在下面一个<span class="string">&#x27;HELLO WORLD&lt;br&gt;&#x27;</span></span><br><span class="line">[student@workstation my_webservers_DEV]$ vim templates/index.html.j2</span><br><span class="line">&#123;&#123; apache_test_message &#125;&#125; &#123;&#123; ansible_distribution &#125;&#125; &#123;&#123; ansible_distribution_version &#125;&#125; &lt;br&gt;</span><br><span class="line">Current Host: &#123;&#123; ansible_hostname &#125;&#125; &lt;br&gt;</span><br><span class="line">Server list: &lt;br&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> host <span class="keyword">in</span> <span class="built_in">groups</span>[<span class="string">&#x27;all&#x27;</span>] %&#125;</span><br><span class="line">&#123;&#123; host &#125;&#125; &lt;br&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">HELLO WORLD &lt;br&gt;	👈</span><br><span class="line"></span><br><span class="line">&gt; 查看仓库状态</span><br><span class="line">[student@workstation my_webservers_DEV]$ git status</span><br><span class="line">On branch development</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">        modified:   templates/index.html.j2		👈	<span class="string">&#x27;会记录有一个文件做了修改&#x27;</span></span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span><br><span class="line"></span><br><span class="line">&gt; 将文件添加到暂存区</span><br><span class="line">[student@workstation my_webservers_DEV]$ git add templates/index.html.j2</span><br><span class="line"></span><br><span class="line">[student@workstation my_webservers_DEV]$ git status</span><br><span class="line">On branch development</span><br><span class="line">Changes to be committed:							`等待被commit`</span><br><span class="line">  (use <span class="string">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage)</span><br><span class="line"></span><br><span class="line">       ` modified:   templates/index.html.j2			</span><br><span class="line"></span><br><span class="line">&gt; 带上<span class="string">&#x27;My first commit&#x27;</span>的message提交</span><br><span class="line">[student@workstation my_webservers_DEV]$ git commit -m <span class="string">&quot;My first commit&quot;</span></span><br><span class="line">[development 3be7041] My first commit</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> </span><br><span class="line">&gt; 此时,工作树就是干净clean的</span><br><span class="line">[student@workstation my_webservers_DEV]$ git status</span><br><span class="line">On branch development</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line"></span><br><span class="line">- 也可以 git <span class="built_in">log</span> 查看提交的具体信息(作者、邮件、时间)</span><br><span class="line"></span><br><span class="line">- 此时master分支上的<span class="string">&#x27;index.html.j2&#x27;</span>并没有发生更改</span><br><span class="line"></span><br><span class="line">&gt; 查看远程仓库的名字	`默认都是 origin`</span><br><span class="line">[student@workstation my_webservers_DEV]$ git remote -v</span><br><span class="line">origin  http://git@git.lab.example.com:8081/git/my_webservers_DEV.git (fetch)</span><br><span class="line">origin  http://git@git.lab.example.com:8081/git/my_webservers_DEV.git (push)</span><br><span class="line"></span><br><span class="line">- 因为远程仓库没有<span class="string">&#x27;development&#x27;</span>分支,所以推送分支需要带上 -u (--set-upstream) </span><br><span class="line">&gt; 推送分支到远程仓库</span><br><span class="line">[student@workstation my_webservers_DEV]$ git push -u origin development</span><br><span class="line"></span><br><span class="line">- 此时可以在web地址上看到多了一个<span class="string">&#x27;development&#x27;</span></span><br><span class="line">- 功能测试没有问题,可以合并到主线(master)上</span><br><span class="line"></span><br><span class="line">&gt; 首先需要先切换到master上</span><br><span class="line">[student@workstation my_webservers_DEV]$ git checkout master</span><br><span class="line">Switched to branch <span class="string">&#x27;master&#x27;</span></span><br><span class="line">Your branch is up to <span class="built_in">date</span> with <span class="string">&#x27;origin/master&#x27;</span>.</span><br><span class="line"></span><br><span class="line">&gt; 合并<span class="string">&#x27;development&#x27;</span>分支</span><br><span class="line">[student@workstation my_webservers_DEV]$ git merge development</span><br><span class="line">Updating af8a56e..3be7041</span><br><span class="line">Fast-forward</span><br><span class="line"> templates/index.html.j2 | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> </span><br><span class="line">&gt; 此时master模板里的内容会显示<span class="string">&#x27;HELLO WORLD&#x27;</span></span><br><span class="line">[student@workstation my_webservers_DEV]$ grep <span class="string">&quot;HELLO WORLD&quot;</span> templates/index.html.j2</span><br><span class="line">HELLO WORLD &lt;br&gt;</span><br><span class="line"></span><br><span class="line">- 但此时web界面的远程仓库里的文件还未发生更改,只是在本地仓库里合并了</span><br><span class="line"></span><br><span class="line">&gt; 需要将master分支新的更改推送到远程仓库</span><br><span class="line">[student@workstation my_webservers_DEV]$ git push</span><br></pre></td></tr></table></figure>

<p><img src="/../../../Typora%20%E5%9B%BE%E5%83%8F/image-20220707155741784.png" alt="image-20220707155741784"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- 此时远程仓库才和本地仓库同步</span><br><span class="line"></span><br><span class="line">&gt; 可以使用 git revert 取消上一次的提交	--HEAD 指向上一次的提交</span><br><span class="line">[student@workstation my_webservers_DEV]$ git revert --no-edit HEAD</span><br><span class="line">[master eadd5c7] Revert <span class="string">&quot;My first commit&quot;</span></span><br><span class="line"> Date: Thu Jul 7 23:59:46 2022 +0800</span><br><span class="line"> 1 file changed, 1 deletion(-)	👈	有一行被删除了</span><br><span class="line"></span><br><span class="line">&gt; 查看模板里的 HELLOWORLD		</span><br><span class="line">[student@workstation my_webservers_DEV]$ grep <span class="string">&quot;HELLO WORLD&quot;</span> templates/index.html.j2					<span class="string">&#x27;此时就没有此内容了&#x27;</span></span><br><span class="line">[student@workstation my_webservers_DEV]$</span><br><span class="line"></span><br><span class="line">- 同样,远程仓库还未发生更改</span><br><span class="line">&gt; 推送到远程仓库</span><br><span class="line">[student@workstation my_webservers_DEV]$ git push</span><br></pre></td></tr></table></figure>

<p><img src="/../../../Typora%20%E5%9B%BE%E5%83%8F/image-20220707160702025.png" alt="image-20220707160702025"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">结束实验</span><br><span class="line">[student@workstation ~]$ lab development-git finish</span><br></pre></td></tr></table></figure>






























      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/08/%E5%88%A9%E7%94%A8%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91/" data-id="cl5bu87o40000x8as4u75g9ng" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/07/08/%E5%88%A9%E7%94%A8%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>